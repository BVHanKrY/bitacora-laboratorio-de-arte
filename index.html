<!-- PARTE 1/2 -->
<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Bitácora Segundo Semestre</title>

<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">

<style>
body{
  margin:0;
  font-family:Roboto,sans-serif;
  background:#f8f3e0;
}

header{
  position:sticky;
  top:0;
  background:#f2d5a8;
  padding:12px;
}

.page{max-width:1200px;margin:auto;padding:20px}

.container{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(320px,1fr));
  gap:16px;
}

.card{
  background:#fff;
  padding:14px;
  border-radius:16px;
}

.card img{width:100%;border-radius:12px}

.badge{font-size:12px}

.controls{
  display:flex;
  gap:8px;
  margin-top:10px;
}

button{
  cursor:pointer;
}

.top-bar{
  display:flex;
  gap:10px;
  margin-bottom:20px;
}

input[type="search"]{
  flex:1;
  padding:8px;
}

.fab{
  position:fixed;
  bottom:20px;
  right:20px;
  font-size:32px;
  border-radius:50%;
  width:60px;
  height:60px;
}
.modal{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.4);
  display:flex;
  align-items:center;
  justify-content:center;
}
.hidden{display:none}
.modal-content{
  background:#fff;
  padding:20px;
  border-radius:12px;
  width:320px;
}
</style>
</head>

<body>

<header>
  <h2>Bitácora Segundo Semestre</h2>
</header>

<main class="page">

<div class="top-bar">
  <input type="search" id="searchInput" placeholder="Buscar por semana o texto">
  <button id="exportJSON">Exportar JSON</button>
  <button onclick="window.print()">Exportar PDF</button>
</div>

<div class="container" id="cards"></div>

</main>

<button class="fab" id="newPost">+</button>

<div class="modal hidden" id="modal">
  <div class="modal-content">
    <h3 id="modalTitle">Nuevo registro</h3>

    <input type="number" id="weekInput" placeholder="Semana">
    <textarea id="textInput" placeholder="Texto"></textarea>
    <input type="file" id="imgInput">

    <div class="controls">
      <button id="save">Guardar</button>
      <button id="cancel">Cancelar</button>
    </div>
  </div>
</div>
<script>
const cards = document.getElementById("cards");
const modal = document.getElementById("modal");
const newPost = document.getElementById("newPost");
const saveBtn = document.getElementById("save");
const cancelBtn = document.getElementById("cancel");
const searchInput = document.getElementById("searchInput");
const exportJSON = document.getElementById("exportJSON");

let posts = JSON.parse(localStorage.getItem("posts")) || [];
let editingIndex = null;

function saveStorage(){
  localStorage.setItem("posts", JSON.stringify(posts));
}

function render(filter=""){
  cards.innerHTML="";
  posts
    .filter(p =>
      p.text.toLowerCase().includes(filter) ||
      String(p.week).includes(filter)
    )
    .forEach((p,i)=>{
      const el = document.createElement("div");
      el.className="card";
      el.innerHTML=`
        <span class="badge">Semana ${p.week}</span>
        <p>${p.text}</p>
        ${p.img ? `<img src="${p.img}">` : ""}
        <div class="controls">
          <button onclick="editPost(${i})">Editar</button>
          <button onclick="deletePost(${i})">Borrar</button>
        </div>
      `;
      cards.appendChild(el);
    });
}

function editPost(i){
  editingIndex=i;
  const p=posts[i];
  weekInput.value=p.week;
  textInput.value=p.text;
  modal.classList.remove("hidden");
}

function deletePost(i){
  if(confirm("¿Borrar esta semana?")){
    posts.splice(i,1);
    saveStorage();
    render(searchInput.value.toLowerCase());
  }
}

newPost.onclick=()=>{
  editingIndex=null;
  weekInput.value="";
  textInput.value="";
  modal.classList.remove("hidden");
};

cancelBtn.onclick=()=>modal.classList.add("hidden");

saveBtn.onclick=()=>{
  const week=weekInput.value;
  const text=textInput.value;
  const file=imgInput.files[0];

  if(!week||!text)return alert("Completa los campos");

  const saveData=(img)=>{
    const data={week,text,img};
    if(editingIndex!==null){
      posts[editingIndex]=data;
    }else{
      posts.push(data);
    }
    saveStorage();
    modal.classList.add("hidden");
    render(searchInput.value.toLowerCase());
  };

  if(file){
    const r=new FileReader();
    r.onload=()=>saveData(r.result);
    r.readAsDataURL(file);
  }else{
    saveData(null);
  }
};

searchInput.oninput=()=>{
  render(searchInput.value.toLowerCase());
};

exportJSON.onclick=()=>{
  const blob=new Blob([JSON.stringify(posts,null,2)],{type:"application/json"});
  const a=document.createElement("a");
  a.href=URL.createObjectURL(blob);
  a.download="bitacora.json";
  a.click();
};

render();
</script>
</body>
</html>
